// ─── Subscriptions & Products ───────────────────────────────────────────────

enum StripeProductMapKind {
  BASE
  SEAT
  ADDON
  OVERAGE
  TOPUP
}

enum TeamSubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  INCOMPLETE
  TRIALING
  UNPAID
}

model Plan {
  id     String @id @default(uuid())
  appId  String
  code   String
  name   String
  status String @default("ACTIVE")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  app               App                @relation(fields: [appId], references: [id])
  stripeProductMaps StripeProductMap[]
  subscriptions     TeamSubscription[]

  @@unique([appId, code])
}

model Addon {
  id     String @id @default(uuid())
  appId  String
  code   String
  name   String
  status String @default("ACTIVE")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  app               App                @relation(fields: [appId], references: [id])
  stripeProductMaps StripeProductMap[]
  teamAddons        TeamAddon[]

  @@unique([appId, code])
}

model StripeProductMap {
  id              String             @id @default(uuid())
  appId           String
  planId          String?
  addonId         String?
  stripeProductId String
  stripePriceId   String
  kind            StripeProductMapKind

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  plan  Plan?  @relation(fields: [planId], references: [id])
  addon Addon? @relation(fields: [addonId], references: [id])

  @@unique([appId, stripePriceId])
}

model TeamSubscription {
  id                    String                 @id @default(uuid())
  teamId                String
  stripeSubscriptionId  String                 @unique
  status                TeamSubscriptionStatus
  planId                String
  currentPeriodStart    DateTime
  currentPeriodEnd      DateTime
  seatsQuantity         Int                    @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  team Team @relation(fields: [teamId], references: [id])
  plan Plan @relation(fields: [planId], references: [id])

  @@index([teamId])
}

model TeamAddon {
  id       String @id @default(uuid())
  teamId   String
  addonId  String
  status   String @default("ACTIVE")
  quantity Int    @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  team  Team  @relation(fields: [teamId], references: [id])
  addon Addon @relation(fields: [addonId], references: [id])

  @@index([teamId])
  @@index([addonId])
}
